<mvc:View
    controllerName="opportunity.opportunity.controller.OpportunityDetail"
    xmlns:u="sap.uxap"
    xmlns:mvc="sap.ui.core.mvc"
    displayBlock="true"
    xmlns:form="sap.ui.layout.form"
    xmlns:f="sap.f"
    xmlns:l="sap.ui.layout"
    xmlns:t="sap.ui.table"
    xmlns="sap.m"
    xmlns:core="sap.ui.core"
    xmlns:suite="sap.suite.ui.commons"
    xmlns:rte="sap.ui.richtexteditor"
    xmlns:grid="sap.ui.layout.cssgrid"
    xmlns:tnt="sap.tnt"
    xmlns:dnd="sap.ui.core.dnd"
    xmlns:dnd-grid="sap.f.dnd"
    xmlns:commons="sap.suite.ui.commons"
    xmlns:micro="sap.suite.ui.microchart"
    xmlns:smartTable="sap.ui.comp.smarttable"
    xmlns:fb="sap.ui.comp.filterbar"
    xmlns:smartFilterBar="sap.ui.comp.smartfilterbar"
>
    <Page
        id="OpportunityDetail"
        showHeader="false"
    >
        <content>
            <u:ObjectPageLayout
                id="ObjectPageLayout"
                showTitleInHeaderContent="true"
                showEditHeaderButton="true"
                editHeaderButtonPress="handleEditBtnPress"
                upperCaseAnchorBar="false"
            >
                <u:headerTitle>
                    <u:ObjectPageDynamicHeaderTitle>
                        <u:expandedHeading>
                            <HBox>
                                <Avatar
                                    class="sapUiTinyMarginEnd"
                                    initials="{path: 'marketUnit', formatter:'.formatter.formatInitials'}"
                                    backgroundColor="{path: 'marketUnit', formatter:'.formatter.formatInitialsColor'}"
                                    tooltip="{marketUnit}"
                                />
                                <VBox>
                                    <Title text="{account}" />
                                    <Text
                                        text="Priority: {priority}"
                                        class="sapUiNeutral"
                                        visible="{= ${priority} !== null}"
                                    />
                                    <!-- <Button
                                            text="{priority}"
                                            visible="{= ${priority} !== null}"
                                            type="{path: 'priority', formatter:'.formatter.priortityButton'}"
                                            class="sapUiSmallMarginBeginEnd"
                                        /> -->
                                </VBox>

                                <!-- <HBox
                                    width="600px"
                                    alignItems="Start"
                                >
                                    <l:HorizontalLayout
                                        id="topicsID"
                                        allowWrapping="true"
                                        class="sapUiLargeMarginBegin"
                                        content="{}"
                                    >
                                        <tnt:InfoLabel
                                            text="{ path: 'pageModel>topic' }"
                                            renderMode="Narrow"
                                            class="sapUiTinyMarginEnd sapUiTinyMarginTopBottom"
                                            colorScheme="{path:'pageModel>topic', formatter:'.formatter.topicColorSchemeFormatter'}"
                                            visible="{= ${pageModel>topic} !== null &amp;&amp; ${pageModel>topic} !== '' }"
                                        >
                                            <tnt:customData>
                                                <core:CustomData
                                                    key="topic"
                                                    value="{pageModel>topic}"
                                                    class="sapUiNoMarginTop sapUiNoMarginBottom"
                                                />
                                            </tnt:customData>
                                        </tnt:InfoLabel>
                                    </l:HorizontalLayout>
                                </HBox> -->
                            </HBox>
                        </u:expandedHeading>
                        <u:snappedHeading>
                            <FlexBox
                                fitContainer="true"
                                alignItems="Center"
                            >
                                <Avatar
                                    class="sapUiTinyMarginEnd"
                                    initials="{path: 'marketUnit', formatter:'.formatter.formatInitials'}"
                                    backgroundColor="{path: 'marketUnit', formatter:'.formatter.formatInitialsColor'}"
                                    tooltip="{marketUnit}"
                                />
                                <Title
                                    text="{account}"
                                    wrapping="true"
                                />
                            </FlexBox>
                        </u:snappedHeading>

                        <u:navigationActions>
                            <!-- <OverflowToolbarButton
                                        icon="sap-icon://delete"
                                        text="{i18n>deleteItemTooltip}"
                                        tooltip="{i18n>deleteItemTooltip}"
                                        press="onDeleteObjectPress" 
                                    /> -->
                            <!-- <core:Icon
                                        press="onFavoriteObjectPress"
                                        tooltip="{i18n>favoriteItemTooltip}"
                                        src="{path: 'isFavorite', formatter: '.formatter.favoriteIconFormatter'}"
                                        size="1.1rem" 
                                        color="#427cac"
                                    /> -->

                            <OverflowToolbarButton
                                type="Transparent"
                                icon="sap-icon://full-screen"
                                press=".handleFullScreen"
                                id="enterFullScreenBtn"
                                tooltip="Enter Full Screen Mode"
                            />
                            <OverflowToolbarButton
                                type="Transparent"
                                icon="sap-icon://exit-full-screen"
                                press=".handleExitFullScreen"
                                id="exitFullScreenBtn"
                                tooltip="Exit Full Screen Mode"
                                visible="false"
                            />
                            <OverflowToolbarButton
                                type="Transparent"
                                icon="sap-icon://decline"
                                press=".handleClose"
                                tooltip="Close middle column"
                            />
                        </u:navigationActions>
                    </u:ObjectPageDynamicHeaderTitle>
                </u:headerTitle>
                <u:headerContent>
                    <FlexBox wrap="Wrap">
                        <!-- <Avatar
                                    displaySize="L"
                                    press="onAvatarPress"
                                    backgroundColor="{path: 'marketUnit', formatter:'.formatter.formatInitialsColor'}"
                                    initials="{path: 'marketUnit', formatter:'.formatter.formatInitials'}"
                                /> -->

                        <!-- <VBox
                                    class="sapUiSmallMarginEnd sapUiMediumMarginBottom"
                                    visible="{= ${opportunityCreatedQuarter} !== null}"
                                >
                                    <Title
                                        text="{i18n>opportunityCreatedQuarter}"
                                        class="sapUiTinyMarginBottom"
                                    />
                                    <ObjectStatus
                                        text="{opportunityCreatedQuarter}"
                                        icon="sap-icon://workflow-tasks"
                                        class="sapMObjectStatusLarge"
                                    />
                                </VBox> -->

                        <!-- adoption -->

                        <VBox
                            visible="{=!${editModel>/editMode}}"
                            class="sapUiSmallMarginTop"
                        >
                            <Title
                                text="{i18n>Adoption}"
                                class="sapUiSmallMarginBegin"
                            />
                            <micro:RadialMicroChart
                                id="adoptionChart"
                                size="S"
                                visible="{= ${adoption} !== null}"
                                percentage="{adoption}"
                                press="press"
                                class="sapUiMediumMarginBegin"
                                width="10%"
                            />
                        </VBox>

                        <VBox
                            class="sapUiSmallMarginTop sapUiTinyMarginBeginEnd"
                            width="15%"
                            visible="{= ${editModel>/editMode}}"
                        >
                            <Title text="{i18n>Adoption}" />
                            <Slider
                                value="{editPageModel>/adoption}"
                                width="100%"
                                step="25"
                                change="onProgressSliderChange"
                                min="0"
                                max="100"
                                showAdvancedTooltip="true"
                                showHandleTooltip="false"
                                class="sapUiSmallMarginTop"
                                enableTickmarks="true"
                            />
                        </VBox>

                        <!-- consumption -->

                        <VBox
                            visible="{=!${editModel>/editMode}}"
                            class="sapUiSmallMarginTop"
                        >
                            <Title
                                text="{i18n>Consumption}"
                                class="sapUiSmallMarginBegin"
                            />
                            <micro:RadialMicroChart
                                id="consumptionChart"
                                size="S"
                                visible="{= ${consumption} !== null}"
                                percentage="{consumption}"
                                press="press"
                                class="sapUiMediumMarginBegin"
                                width="10%"
                            />
                        </VBox>

                        <VBox
                            class="sapUiSmallMarginTop sapUiTinyMarginBeginEnd"
                            width="15%"
                            visible="{= ${editModel>/editMode}}"
                        >
                            <Title text="{i18n>Consumption}" />
                            <Slider
                                value="{editPageModel>/consumption}"
                                width="100%"
                                step="25"
                                change="onProgressSliderChange"
                                min="0"
                                max="100"
                                showAdvancedTooltip="true"
                                showHandleTooltip="false"
                                class="sapUiSmallMarginTop"
                                enableTickmarks="true"
                            />
                        </VBox>

                        <VBox
                            class="sapUiMediumMarginBegin sapUiSmallMarginTop"
                            visible="{= ${opportunityValue} !== null}"
                        >
                            <Title
                                text="{i18n>Value}"
                                class="sapUiTinyMarginBottom"
                            />
                            <ObjectNumber
                                class="sapMObjectNumberLarge"
                                state="{path: 'opportunityValue', formatter: '.formatter.numberStateFormatter'}"
                                number="{path: 'opportunityValue', type: 'sap.ui.model.type.Float', formatter: '.formatter.addKAfterNumber', formatOptions: {decimals: 0}}"
                                unit="EUR"
                            />
                        </VBox>

                        <l:VerticalLayout class="sapUiResponsiveMargin">
                            <HBox>
                                <VBox
                                    class="sapUiSmallMarginBottom"
                                    visible="{= ${subTaskModel>/subtasks}.length > 0}"
                                >
                                    <Title text="Tasks" />
                                    <commons:MicroProcessFlow
                                        renderType="Scrolling"
                                        class="sapUiTinyMarginTop"
                                        content="{path: 'subTaskModel>/subtasks', sorter: { path: 'subTaskOrder' }}"
                                    >
                                        <commons:content>
                                            <commons:MicroProcessFlowItem
                                                state="{path: 'subTaskModel>subTaskStatus', formatter: '.formatter.processFlowFormatter'}"
                                                press="onPopoverPress"
                                                icon="{path: 'subTaskModel>subTaskStatus', formatter: '.formatter.formatSubTaskIcon'}"
                                            />
                                        </commons:content>
                                    </commons:MicroProcessFlow>
                                </VBox>
                                <VBox class="sapUiMediumMarginBeginEnd">
                                    <ObjectStatus
                                        state="Information"
                                        text="{i18n>status}"
                                        icon="sap-icon://message-information"
                                    />
                                    <HBox
                                        alignItems="Center"
                                        justifyContent="Center"
                                        width="100%"
                                    >
                                        <VBox>
                                            <SegmentedButton
                                                selectionChange="onSegmentPressed"
                                                id="segmentedStatusObject"
                                                width="300px"
                                                class="sapUiTinyMarginBeginEnd sapUiTinyMarginTop"
                                                selectedKey="{status}"
                                            >
                                                <items>
                                                    <SegmentedButtonItem
                                                        icon="sap-icon://flag-2"
                                                        text=""
                                                        width="50px"
                                                        key="Lead"
                                                        tooltip="Lead"
                                                    />
                                                    <SegmentedButtonItem
                                                        icon="sap-icon://overlay"
                                                        text=""
                                                        width="50px"
                                                        key="Opportunity"
                                                        tooltip="Opportunity"
                                                    />
                                                    <SegmentedButtonItem
                                                        icon="sap-icon://pause"
                                                        text=""
                                                        width="50px"
                                                        key="Paused"
                                                        tooltip="Paused"
                                                    />
                                                    <SegmentedButtonItem
                                                        icon="sap-icon://activate"
                                                        text=""
                                                        width="50px"
                                                        key="Delivery"
                                                        tooltip="Delivery"
                                                    />
                                                    <SegmentedButtonItem
                                                        icon="sap-icon://checklist-item"
                                                        text=""
                                                        width="50px"
                                                        key="Completed"
                                                        tooltip="Completed"
                                                    />
                                                </items>
                                            </SegmentedButton>
                                        </VBox>
                                    </HBox>
                                </VBox>
                            </HBox>
                        </l:VerticalLayout>
                    </FlexBox>
                </u:headerContent>
                <!-- section fragments -->
                <u:sections>
                    <u:ObjectPageSection
                        id="idGeneralSection"
                        titleUppercase="false"
                        title="{i18n>generalHeader}"
                    >
                        <u:ObjectPageSubSection
                            id="idGeneralSubSection"
                            visible="{= !${editModel>/editMode}}"
                        >
                            <core:Fragment
                                id="idGeneralFragment"
                                fragmentName="opportunity.opportunity.view.fragments.sections.GeneralSection"
                                type="XML"
                            />
                        </u:ObjectPageSubSection>

                        <u:ObjectPageSubSection
                            id="idGeneralSectionEdit"
                            visible="{= ${editModel>/editMode}}"
                        >
                            <core:Fragment
                                fragmentName="opportunity.opportunity.view.fragments.sections.GeneralSectionEdit"
                                type="XML"
                            />
                        </u:ObjectPageSubSection>
                    </u:ObjectPageSection>
                    <u:ObjectPageSection
                        id="idSectionTasks"
                        titleUppercase="false"
                        title="Tasks"
                    >
                        <u:ObjectPageSubSection id="idSubSectionTasks">
                            <Table
                                id="subTaskTable"
                                items="{
                                            path : 'subTaskModel>/subtasks', templateShareable:true,
                                            sorter:
                                                {
                                                    path: 'subTaskOrder',
                                                    descending: false
                                                },
                                            parameters: {
                                                $count: true
                                            }
                                        }"
                                selectionChange="onSelectSubTask"
                                inset="false"
                                growing="true"
                                growingScrollToLoad="true"
                                mode="MultiSelect"
                                sticky="ColumnHeaders,HeaderToolbar"
                                noDataText="{i18n>noDataSubTasks}"
                            >
                                <headerToolbar>
                                    <OverflowToolbar design="Transparent">
                                        <SegmentedButton
                                            id="subTaskFilter"
                                            selectedKey="all"
                                            selectionChange="onSubTaskFilter"
                                            class="sapMSegmentedButtonNoAutoWidth"
                                        >
                                            <items>
                                                <SegmentedButtonItem
                                                    text="All"
                                                    key="All"
                                                />
                                                <SegmentedButtonItem
                                                    text="Open ({subTaskModel>/completedCount})"
                                                    key="Open"
                                                />
                                                <SegmentedButtonItem
                                                    text="Completed"
                                                    key="Completed"
                                                />
                                            </items>
                                        </SegmentedButton>

                                        <ToolbarSpacer />

                                        <Button
                                            type="Accept"
                                            text="Add"
                                            tooltip="{i18n>addTableItem}"
                                            press="onAddSubTask"
                                        />

                                        <Button
                                            text="Clear completed"
                                            icon="sap-icon://clear-all"
                                            tooltip="{i18n>deleteSelected}"
                                            press="onDeleteSubTasks"
                                        />
                                    </OverflowToolbar>
                                </headerToolbar>

                                <columns>
                                    <Column
                                        hAlign="Center"
                                        width="3em"
                                    >
                                        <customData>
                                            <core:CustomData key="p13nData" />
                                        </customData>
                                        <Label />
                                    </Column>

                                    <Column width="40%">
                                        <customData>
                                            <core:CustomData
                                                key="p13nData"
                                                value='\{"columnKey": "subTask", "columnIndex" : "1", "leadingProperty": "subTask", "sortProperty": "subTask", "filterProperty": "subTask ", "type":"string"}'
                                            />
                                        </customData>
                                        <Label
                                            text="{i18n>subTask}"
                                            tooltip="{i18n>subTask}"
                                        />
                                    </Column>
                                    <Column width="5em">
                                        <customData>
                                            <core:CustomData
                                                key="p13nData"
                                                value='\{"columnKey": "subTaskOwner", "columnIndex" : "2", "leadingProperty": "subTaskOwner", "sortProperty": "subTaskOwner", "filterProperty": "subTaskOwner ", "type":"string"}'
                                            />
                                        </customData>
                                        <Label
                                            text="{i18n>subTaskOwner}"
                                            tooltip="{i18n>subTaskOwner}"
                                        />
                                    </Column>

                                    <Column width="5.5em">
                                        <customData>
                                            <core:CustomData key="p13nData" />
                                        </customData>
                                        <Label
                                            text="Status"
                                            tooltip="Status"
                                        />
                                    </Column>

                                    <Column width="5em">
                                        <customData>
                                            <core:CustomData
                                                key="p13nData"
                                                value='\{"columnKey": "subTaskDueDate", "columnIndex" : "3", "leadingProperty": "subTaskDueDate", "sortProperty": "subTaskDueDate", "filterProperty": "subTaskDueDate ", "type":"string"}'
                                            />
                                        </customData>
                                        <Label
                                            text="{i18n>subTaskDueDate}"
                                            tooltip="{i18n>subTaskDueDate}"
                                        />
                                    </Column>

                                    <Column width="3em">
                                        <customData>
                                            <core:CustomData key="p13nData" />
                                        </customData>
                                        <Label />
                                    </Column>

                                    <Column width="3em">
                                        <customData>
                                            <core:CustomData key="p13nData" />
                                        </customData>
                                        <Label />
                                    </Column>
                                </columns>
                                <items>
                                    <ColumnListItem
                                        type="Detail"
                                        detailPress="onEditSubTask"
                                        vAlign="Middle"
                                        selected="{subTaskModel>subTaskCompleted}"
                                    >
                                        <cells>
                                            <Text
                                                text="{= ${subTaskModel>subTaskOrder} + 1}.)"
                                            />

                                            <Text
                                                text="{subTaskModel>subTask}"
                                                wrapping="true"
                                            />

                                            <Avatar
                                                src="{path: 'subTaskModel>subTaskOwner', formatter: '.formatter.formatterTeamPictures'}"
                                                displayShape="Circle"
                                                displaySize="XS"
                                                class="imageDisplayBlock sapUiTinyMarginBeginEnd"
                                                visible="{= ${subTaskModel>subTaskOwner} !== null &amp;&amp; ${subTaskModel>subTaskOwner} !== ''}"
                                                tooltip="{subTaskModel>subTaskOwner}"
                                            />


                                            <MenuButton
                                                text="{subTaskModel>subTaskStatus}"
                                                buttonMode="Split"
                                                width="140px"
                                                icon="{path: 'subTaskModel>subTaskStatus', formatter:'.formatter.formatSubTaskIcon'}"
                                            >
                                                <menu>
                                                    <Menu
                                                        itemSelected="onMenuAction"
                                                        items="{path: '/opportunitySubTaskStatus', templateShareable:true}"
                                                    >
                                                        <MenuItem
                                                            press="onSubTaskStatusChange"
                                                            text="{subTaskStatus}"
                                                            icon="{path: 'subTaskStatus', formatter:'.formatter.formatSubTaskIcon'}"
                                                        />
                                                    </Menu>
                                                </menu>
                                            </MenuButton>

                                            <ObjectStatus
                                                text="{
                                                            path: 'subTaskModel>subTaskDueDate',
                                                            type: 'sap.ui.model.type.Date',
                                                            formatOptions: {
                                                                relative: true,
                                                                relativeScale: 'auto'
                                                            }
                                                        }"
                                                icon="{path: 'subTaskModel>subTaskDueDate', formatter:'.formatter.formatIconDueDate'}"
                                                state="{path: 'subTaskModel>subTaskDueDate', formatter:'.formatter.formatDueDate'}"
                                                visible="{= ${subTaskModel>subTaskDueDate} !== null}"
                                            />

                                            <core:Icon
                                                press="onReorderUp"
                                                src="sap-icon://slim-arrow-up"
                                                size="1.2rem"
                                                color="#427cac"
                                                tooltip="Move the Sub-Task one up"
                                            />
                                            <core:Icon
                                                press="onReorderDown"
                                                src="sap-icon://slim-arrow-down"
                                                size="1.2rem"
                                                color="#427cac"
                                                tooltip="Move the Sub-Task one down"
                                            />
                                        </cells>
                                    </ColumnListItem>
                                </items>
                                <noData>
                                    <IllustratedMessage
                                        enableVerticalResponsiveness="true"
                                        illustrationType="sapIllus-NoTasks"
                                        title="No Tasks Found"
                                        description="Start by creating one"
                                    />
                                </noData>
                            </Table>
                        </u:ObjectPageSubSection>
                    </u:ObjectPageSection>

                    <!-- NEW Topics -->

                    <u:ObjectPageSection
                        id="topicsSection"
                        titleUppercase="false"
                        title="Topics"
                    >
                        <u:ObjectPageSubSection id="idTopicsSection">
                            <List
                                id="topicsList"
                                items="{}"
                                mode="Delete"
                                includeItemInSelection="true"
                                selectionChange="onSelectLink"
                                delete="onDeleteTopic"
                            >
                                <headerToolbar>
                                    <OverflowToolbar>
                                        <content>
                                            <Title
                                                text="Ownership"
                                                level="H5"
                                            />
                                            <ToolbarSpacer />
                                            <Button
                                                type="Accept"
                                                text="Add"
                                                press="onAddNewTopic"
                                            />
                                        </content>
                                    </OverflowToolbar>
                                </headerToolbar>
                                <items>
                                    <CustomListItem
                                        press="onSelectLink"
                                        type="Active"
                                        id="topicsTemplate"
                                    >
                                        <HBox
                                            alignItems="Center"
                                            class="sapUiTinyMargin"
                                        >
                                            <!-- <Avatar
                                                src="{avatarImageUrl}"
                                                displayShape="Circle"
                                                displaySize="S"
                                                class="sapUiTinyMarginEnd"
                                            /> -->

                                               <tnt:InfoLabel 
                                            text="{ path: 'topic' }"
                                            renderMode="Narrow"
                                            class="sapUiSmallMarginBeginEnd sapUiTinyMarginTopBottom"
                                            colorScheme="{path:'topic', formatter:'.formatter.topicColorSchemeFormatter'}"
                                            visible="{= ${topic} !== null &amp;&amp; ${topic} !== '' }"
                                        />

                                                               <Avatar
                                                src="{path: 'topicOwner', formatter: '.formatter.formatterTeamPictures'}"
                                                displayShape="Circle"
                                                displaySize="XS"
                                                class="imageDisplayBlock sapUiLargeMediumBegin sapUiTinyMarginEnd"
                                                visible="{= ${topicOwner} !== null &amp;&amp; ${topicOwner} !== ''}"
                                                tooltip="{topicOwner}"
                                            />

                                              <Text text="{topicOwner}" class="sapUiSmallMarginEnd"></Text>

                                        <Text class="sapUiSmallMarginBegin" text="{comment}"></Text>

                         
                                            
                                            <!-- <VBox>
                                                <Title
                                                    text="{topic}"
                                                    level="H6"
                                                />
                                                <Text
                                                    text="{comment}"
                                                    wrapping="true"
                                                />
                                            </VBox> -->
                                        </HBox>
                                    </CustomListItem>
                                </items>
                                <noData>
                                    <!-- Illustrated message when there is no data -->
                                    <IllustratedMessage
                                        enableVerticalResponsiveness="true"
                                        illustrationType="sapIllus-Tent"
                                        title="No Topics for this Account"
                                        description="Start by adding a topic and assigning an owner to it."
                                    />
                                </noData>
                            </List>
                        </u:ObjectPageSubSection>
                    </u:ObjectPageSection>

                    <!-- <u:ObjectPageSection
                        id="idSectionTopics"
                        titleUppercase="false"
                    >
                        <u:ObjectPageSubSection
                            id="idSubSectionTopics"
                            titleUppercase="false"
                            title="Topics"
                        >
                            <VBox width="100%">
                                <MessageStrip
                                    showIcon="true"
                                    class="sapUiTinyMarginTop"
                                    text="The relevant Topics for {account} are shown in blue. Go into Edit Mode to select more."
                                    showCloseButton="true"
                                />
                                <HBox width="100%">
                                    <VBox width="50%">
                                        <l:HorizontalLayout
                                            id="TopicFiltersObject"
                                            allowWrapping="true"
                                            class="sapUiResponsiveMargin"
                                            content="{}"
                                        >
                                            <ToggleButton
                                                text="{topic}"
                                                press="onPressToggle1"
                                                class="sapUiSmallMarginEnd"
                                                pressed="{parts: [{path: 'pageModel>/topics'}, {path: 'topic'}], formatter: '.formatter.toggleButtonPressed'}"
                                                enabled="{parts: [{path: 'pageModel>/topics'}, {path: 'topic'}, {path: 'editModel>/editMode'}], formatter: '.formatter.toggleButtonEnabled'}"
                                                tooltip="{i18n>toggle1Tooltip}"
                                            >
                                                <customData>
                                                    <core:CustomData
                                                        key="topic"
                                                        value="{topic}"
                                                        class="sapUiNoMarginTop sapUiNoMarginBottom"
                                                    />
                                                </customData>
                                            </ToggleButton>
                                        </l:HorizontalLayout>
                                    </VBox>
                                    <VBox width="50%">
                                        <l:HorizontalLayout
                                            id="DeliverablesFiltersObject"
                                            allowWrapping="true"
                                            class="sapUiResponsiveMargin"
                                            content="{}"
                                        >
                                            <ToggleButton
                                                text="{deliverable}"
                                                press="onPressToggle2"
                                                class="sapUiSmallMarginEnd"
                                                pressed="{parts: [{path: 'pageModel>/deliverables'}, {path: 'deliverable'}], formatter: '.formatter.toggleButtonPressed'}"
                                                enabled="{parts: [{path: 'pageModel>/deliverables'}, {path: 'deliverable'}, {path: 'editModel>/editMode'}], formatter: '.formatter.toggleButtonEnabled'}"
                                                tooltip="{i18n>toggle2Tooltip}"
                                            >
                                                <customData>
                                                    <core:CustomData
                                                        key="ID"
                                                        value="{deliverable}"
                                                        class="sapUiNoMarginTop sapUiNoMarginBottom"
                                                    />
                                                </customData>
                                            </ToggleButton>
                                        </l:HorizontalLayout>
                                    </VBox>
                                </HBox>
                                <HBox width="100%">
                                    <VBox width="50%">
                                        <IllustratedMessage
                                            enableVerticalResponsiveness="true"
                                            illustrationSize="Spot"
                                            illustrationType="sapIllus-AddDimensions"
                                            enableDefaultTitleAndDescription="false"
                                        >
                                            <additionalContent>
                                                <Button
                                                    text="Add Topic"
                                                    type="Accept"
                                                    press="onAddTopicPress"
                                                />
                                            </additionalContent>
                                        </IllustratedMessage>
                                    </VBox>
                                    <VBox width="50%">
                                        <IllustratedMessage
                                            enableVerticalResponsiveness="true"
                                            illustrationSize="Spot"
                                            illustrationType="sapIllus-EmptyPlanningCalendar"
                                            enableDefaultTitleAndDescription="false"
                                        >
                                            <additionalContent>
                                                <Button
                                                    text="Add Deliverable"
                                                    type="Accept"
                                                    press="onAddDeliverablePress"
                                                />
                                            </additionalContent>
                                        </IllustratedMessage>
                                    </VBox>
                                </HBox>
                            </VBox>
                        </u:ObjectPageSubSection>
                    </u:ObjectPageSection> -->

                    <!-- links -->

                    <u:ObjectPageSection
                        id="idSectionLinks"
                        titleUppercase="false"
                        title="{i18n>Links}"
                    >
                        <u:ObjectPageSubSection id="idSubSectionLinks">
                            <List
                                id="linkList"
                                items="{}"
                                mode="Delete"
                                includeItemInSelection="true"
                                selectionChange="onSelectLink"
                                delete="onDeleteLink"
                            >
                                <headerToolbar>
                                    <OverflowToolbar>
                                        <content>
                                            <Title
                                                text="Respository"
                                                level="H5"
                                            />
                                            <ToolbarSpacer />
                                            <Button
                                                type="Accept"
                                                text="Add"
                                                press="onAddNewLink"
                                            />
                                        </content>
                                    </OverflowToolbar>
                                </headerToolbar>
                                <StandardListItem
                                    press="onSelectLink"
                                    type="Active"
                                    id="linkListItem"
                                    title="{linkName}"
                                    description="{linkDescription}"
                                    icon="sap-icon://chain-link"
                                    iconDensityAware="true"
                                    iconInset="true"
                                />
                                <noData>
                                    <!-- Illustrated message when there is no data -->
                                    <IllustratedMessage
                                        enableVerticalResponsiveness="true"
                                        illustrationType="sapIllus-SearchFolder"
                                        title="No Links Found"
                                        description="Start by adding a link to the repository."
                                    />
                                </noData>
                            </List>
                        </u:ObjectPageSubSection>
                    </u:ObjectPageSection>

                    <!-- <u:ObjectPageSection
                                id="idSectionActivities"
                                titleUppercase="false"
                                title="{i18n>Activities}"
                            >
                                <u:ObjectPageSubSection
                                    id="idSubSectionActivities"
                                >
                                    <core:Fragment
                                        fragmentName="opportunity.opportunity.view.fragments.sections.ActivitiesSection"
                                        type="XML"
                                    />
                                </u:ObjectPageSubSection>
                            </u:ObjectPageSection>

                            <u:ObjectPageSection
                                id="idSectionMaturity"
                                titleUppercase="false"
                                title="{i18n>Maturity}"
                            >
                                <u:ObjectPageSubSection
                                    id="idSubSectionMaturity"
                                >
                                    <smartTable:SmartTable
                                        id="maturityTableID"
                                        entitySet="opportunityMaturity"
                                        beforeRebindTable="onBeforeRebindMaturityTable"
                                        tableType="ResponsiveTable"
                                        enableExport="false"
                                        useVariantManagement="false"
                                        useTablePersonalisation="true"
                                        showRowCount="false"
                                        enableAutoBinding="true"
                                        demandPopin="true"
                                        header="Account Assessment"
                                        class="sapUiResponsiveContentPadding"
                                        showFullScreenButton="true"
                                        requestAtLeastFields="topic,maturity,comment"
                                        initiallyVisibleFields="topic,maturity,comment"
                                        ignoreFromPersonalisation="ID,opptID_opportunityID"
                                        enableCopy="false"
                                    >
                                        <Table
                                            id="maturityTable"
                                            inset="false"
                                        >
                                            <columns>
                                                <Column width="15%">
                                                    <customData>
                                                        <core:CustomData
                                                            key="p13nData"
                                                            value='\{"columnKey": "topic", "columnIndex" : "0", "leadingProperty": "topic", "sortProperty": "topic", "filterProperty": "topic", "type":"string"}'
                                                        />
                                                    </customData>
                                                    <Label
                                                        text="{i18n>Topic}"
                                                        tooltip="{i18n>topic}"
                                                    />
                                                </Column>

                                                <Column width="7rem">
                                                    <customData>
                                                        <core:CustomData
                                                            key="p13nData"
                                                            value='\{"columnKey": "maturity", "columnIndex" : "1", "leadingProperty": "maturity", "sortProperty": "maturity", "filterProperty": "maturity", "type":"integer"}'
                                                        />
                                                    </customData>
                                                    <Label
                                                        text="{i18n>Maturity}"
                                                    />
                                                </Column>

                                                <Column width="60%">
                                                    <customData>
                                                        <core:CustomData
                                                            key="p13nData"
                                                            value='\{"columnKey": "comment", "columnIndex" : "2", "leadingProperty": "comment", "sortProperty": "comment", "filterProperty": "comment", "type":"string"}'
                                                        />
                                                    </customData>
                                                    <Label
                                                        text="{i18n>Comment}"
                                                    />
                                                </Column>
                                            </columns>
                                            <items>
                                                <ColumnListItem
                                                    vAlign="Middle"
                                                    type="Detail"
                                                    detailPress="onMaturityEdit"
                                                >
                                                    <cells>
                                                        <ObjectIdentifier
                                                            title="{topic}"
                                                        />
                                                        <RatingIndicator
                                                            id="maturity"
                                                            maxValue="5"
                                                            class="sapUiSmallMarginBottom"
                                                            value="{maturity}"
                                                            tooltip="Maturity for {topic}"
                                                            change="onRatingChange"
                                                        />
                                                        <Text
                                                            text="{comment}"
                                                        />
                                                    </cells>
                                                </ColumnListItem>
                                            </items>
                                        </Table>
                                    </smartTable:SmartTable>
                                </u:ObjectPageSubSection>
                            </u:ObjectPageSection> -->

                    <!-- <u:ObjectPageSection
                                                id="idSmartChartSection"
                                                titleUppercase="false"
                                                title="Comparison"
                                            >
                                                <u:ObjectPageSubSection
                                                    id="idSmartChartSubSection"
                                                >
                                                    <VBox
                                                        alignItems="Center"
                                                        alignContent="Center"
                                                        justifyContent="Center"
                                                        renderType="Div"
                                                    >
                                                        <VBox
                                                            fitContainer="true"
                                                            alignItems="Stretch"
                                                            alignContent="Stretch"
                                                            justifyContent="Start"
                                                            renderType="Div"
                                                            height="520px"
                                                            width="700px"
                                                        >
                                                            <core:Fragment
                                                                fragmentName="opportunity.opportunity.view.fragments.sections.SmartChart"
                                                                type="XML"
                                                            />
                                                        </VBox>
                                                    </VBox>
                                                </u:ObjectPageSubSection>
                                            </u:ObjectPageSection> -->

                    <!-- timeline -->

                    <u:ObjectPageSection
                        id="idNextStepSection"
                        titleUppercase="false"
                        title="Roadmap"
                    >
                        <u:ObjectPageSubSection id="idNextStepSubSection">
                            <VBox height="100%">
                                <layoutData>
                                    <FlexItemData growFactor="1" />
                                </layoutData>

                                <Toolbar>
                                    <ToolbarSpacer />

                                    <Button
                                        type="Accept"
                                        text="Add"
                                        press="onAddNextStep"
                                    />

                                    <Switch
                                        change="onHorizontalSwitch"
                                        state="true"
                                    />
                                    <Label text="Horizontal" />
                                </Toolbar>
                                <commons:Timeline
                                    axisOrientation="Horizontal"
                                    noDataText="There are no Roadmap Items for this opportunity. Start by adding one."
                                    width="100%"
                                    id="idTimeline"
                                    content="{/opportunityNextSteps}"
                                    filterList="{/opportunityNextSteps}"
                                    enableScroll="true"
                                    forceGrowing="false"
                                    growingThreshold="6"
                                    showHeaderBar="false"
                                    sortOldestFirst="true"
                                    enableModelFilter="true"
                                    showIcons="false"
                                    filterTitle="Roadmap Item"
                                    enableDoubleSided="true"
                                    lazyLoading="false"
                                    textHeight="automatic"
                                    showTimeFilter="false"
                                >
                                    <commons:content>
                                        <commons:TimelineItem
                                            id="timelineTasks"
                                            userNameClicked="onUserNameClick"
                                            select="onPressItems"
                                            text="{nextStepDescription}"
                                            userName="{nextStep}"
                                            filterValue="{completed}"
                                            maxCharacters="500"
                                            dateTime="{postedOn}"
                                        >
                                            <commons:embeddedControl>
                                                <VBox>
                                                    <Text
                                                        visible="{= ${nextStepDescription} === true }"
                                                        class="sapUiSmallMarginBegin"
                                                        text="{nextStepDescription}"
                                                        width="90%"
                                                    />

                                                    <HBox justifyContent="End">
                                                        <tnt:InfoLabel
                                                            visible="{= ${completed} === true }"
                                                            text="Completed"
                                                            class="sapUiTinyMarginTop sapUiTinyMarginEnd"
                                                            colorScheme="8"
                                                        />
                                                        <Button
                                                            icon="sap-icon://edit"
                                                            type="Transparent"
                                                            press="onEditNextStep"
                                                        />
                                                    </HBox>
                                                </VBox>
                                            </commons:embeddedControl>
                                        </commons:TimelineItem>
                                    </commons:content>

                                    <commons:filterList>
                                        <commons:TimelineFilterListItem
                                            id="idTimelineFilterListItem"
                                            key="{nextStep}"
                                            text="{nextStep}"
                                        />
                                    </commons:filterList>
                                </commons:Timeline>
                            </VBox>
                        </u:ObjectPageSubSection>
                    </u:ObjectPageSection>

                    <u:ObjectPageSection
                        id="idSectionNotes"
                        titleUppercase="false"
                        title="{i18n>Notes}"
                    >
                        <u:ObjectPageSubSection id="idSubSectionNotes">
                            <!-- <core:Fragment id="notesSection" fragmentName="opportunity.opportunity.view.fragments.sections.NotesSection" type="XML"/> -->
                            <rte:RichTextEditor
                                value="{noteText}"
                                id="editRTE"
                                height="1500px"
                                width="100%"
                                showGroupFont="true"
                                showGroupLink="true"
                                showGroupUndo="true"
                                editable="{editModel>/editMode}"
                            />
                        </u:ObjectPageSubSection>
                    </u:ObjectPageSection>
                </u:sections>
            </u:ObjectPageLayout>
        </content>
        <footer>
            <Toolbar>
                <ToolbarSpacer />
                <Button
                    id="Cancel"
                    text="{i18n>cancel}"
                    press="onCancelObjectPress"
                    type="Reject"
                    visible="{editModel>/editMode}"
                />
                <Button
                    icon="sap-icon://delete"
                    text="Delete"
                    tooltip="{i18n>deleteItemTooltip}"
                    press="onDeleteObjectPress"
                    type="Reject"
                    visible="{= !${editModel>/editMode}}"
                />
                <Button
                    id="EditBtn"
                    text="{i18n>edit}"
                    press="onEditObjectPress"
                    type="Emphasized"
                    visible="{= !${editModel>/editMode}}"
                />
                <Button
                    id="SaveBtn"
                    text="{i18n>save}"
                    press="onSaveObjectPress"
                    type="Success"
                    visible="{editModel>/editMode}"
                />
            </Toolbar>
        </footer>
    </Page>
</mvc:View>
