<mvc:View controllerName="opportunity.opportunity.controller.MainReport"
    id="view1"
    xmlns:u="sap.uxap"
    xmlns:mvc="sap.ui.core.mvc"
    displayBlock="true"
    xmlns:form="sap.ui.layout.form"
    xmlns:f="sap.f"
    xmlns:l="sap.ui.layout"
    xmlns:fb="sap.ui.comp.filterbar"
    xmlns="sap.m"
    xmlns:core="sap.ui.core"
    xmlns:smartFilterBar="sap.ui.comp.smartfilterbar"
    xmlns:smartTable="sap.ui.comp.smarttable"
    xmlns:customData="http://schemas.sap.com/sapui5/extension/sap.ui.core.CustomData/1"
    xmlns:table="sap.ui.table"
    xmlns:plugins="sap.ui.table.plugins"
    xmlns:tnt="sap.tnt"
>
    <f:DynamicPage id="page" title="{i18n>title}" backgroundDesign="List">
        <f:title>
            <f:DynamicPageTitle>
                <f:heading>
                    <Title text="{i18n>title}" id="headerTitle" />
                </f:heading>
            </f:DynamicPageTitle>
        </f:title>
        <f:header>
            <f:DynamicPageHeader pinnable="true">
                <f:content>
                    
                    <smartFilterBar:SmartFilterBar
					id="smartFilterBar"
					entitySet="opportunityHeader"
					persistencyKey="PersistencyKey"
                    liveMode="true"
                    showClearOnFB="true"
                    showGoOnFB="false"
                    showMessages="true"
                    useDateRangeType="true"
                    clear="onClearSmartFilterBar"
                    >

					<smartFilterBar:controlConfiguration>
						<smartFilterBar:ControlConfiguration
							key="marketUnit"
							index="1"
							label="Market Unit"
							visibleInAdvancedArea="true">
							<smartFilterBar:customControl>
								<MultiComboBox
									id="marketUnitFilter"
									customData:hasValue="false"
									selectionChange="customFieldChange">
									<core:Item key="BeLux" text="BeLux"/>
									<core:Item key="France" text="France"/>
									<core:Item key="Netherlands" text="Netherlands"/>
                                    <core:Item key="Nordics" text="Nordics"/>
                                    <core:Item key="UKI" text="UKI"/>
								</MultiComboBox>
							</smartFilterBar:customControl>
						</smartFilterBar:ControlConfiguration>

                        <smartFilterBar:ControlConfiguration
							key="topic"
							index="2"
							label="Topic"
							visibleInAdvancedArea="true">
							<smartFilterBar:customControl>
								<MultiComboBox
									id="topicFilter"
									customData:hasValue="false"
									selectionChange="customFieldChange">
									<core:Item key="Analytics" text="Analytics"/>
									<core:Item key="Automation / AI" text="Automation / AI"/>
									<core:Item key="Clean Core" text="Clean Core"/>
                                    <core:Item key="Data" text="Data"/>
                                    <core:Item key="Extension" text="Extension"/>
                                    <core:Item key="Integration" text="Integration"/>
								</MultiComboBox>
							</smartFilterBar:customControl>
						</smartFilterBar:ControlConfiguration>

                        <smartFilterBar:ControlConfiguration
							key="opportunityInCRM"
							label="Opportunity In CRM"
							visibleInAdvancedArea="true">
							<smartFilterBar:customControl>
								<Switch
									id="customSwitch"
                                    customTextOff="No" customTextOn="Yes"
									customData:hasValue="false"/>
							</smartFilterBar:customControl>
						</smartFilterBar:ControlConfiguration>

					</smartFilterBar:controlConfiguration>
				</smartFilterBar:SmartFilterBar>


                </f:content>
            </f:DynamicPageHeader>
        </f:header>
        <f:content>






  <smartTable:SmartTable 
  id="mySmartTable" 
  entitySet="opportunityHeader" 
  smartFilterId="smartFilterBar" 
  beforeRebindTable="onBeforeRebindTable"
  tableType="ResponsiveTable"  
  beforeExport="onBeforeExport"
  useVariantManagement="true" 
  useTablePersonalisation="true" 
  header="Opportunities"
  showRowCount="true"
  persistencyKey="SmartTablePersistencyKey" 
  enableAutoBinding="true"
  demandPopin="true" 
  class="sapUiResponsiveContentPadding" 
  showFullScreenButton="true" 
  initiallyVisibleFields="account,topic,status,primaryContact,ssa,opportunityClosedQuarter,opportunityValue"
  requestAtLeastFields="marketUnit,account,topic,status,primaryContact,ssa,opportunityClosedQuarter,opportunityValue,topics"
  ignoredFields="opportunityID"
  ignoreFromPersonalisation="opportunityID"                          
   >
     <smartTable:customToolbar>
			<OverflowToolbar design="Transparent">
           
            
				<ToolbarSpacer/>
                <SearchField  width="40%" liveChange="onSearch"/>
				<OverflowToolbarButton icon="sap-icon://add" tooltip="Add Table Item" press="onWizardDialogPress"/>
                <OverflowToolbarButton icon="sap-icon://delete" tooltip="Delete selected Item" press="onDeleteTableItem"/>
                 <ToggleButton icon="sap-icon://unfavorite" tooltip="Show Favorite Items" press="onShowFavorites"/>
			</OverflowToolbar>
	</smartTable:customToolbar>


	<!-- <Table mode="MultiSelect">
		<items>
			<ColumnListItem
				type="Active"
				vAlign="Middle"
				press="onListItemPress">
			</ColumnListItem>
		</items>
	</Table> -->

 <Table  growing="true" growingScrollToLoad="true" mode="MultiSelect" sticky="ColumnHeaders,HeaderToolbar" >
                                                <columns>
                                                    <Column >
                                                        <customData>
                                                            <core:CustomData key="p13nData" value='\{"columnKey": "account", "columnIndex" : "1", "leadingProperty": "account", "sortProperty": "account", "filterProperty": "account ", "type":"string"}'/>
                                                        </customData>
                                                        <Label text="{i18n>account}" tooltip="{i18n>account}"/>
                                                    </Column>

                                                    <Column>
                                                        <customData>
                                                            <core:CustomData key="p13nData" value='\{"columnKey": "primaryContact", "columnIndex" : "2", "leadingProperty": "primaryContact", "sortProperty": "primaryContact", "filterProperty": "primaryContact", "type":"string"}'/>
                                                        </customData>
                                                        <Label text="{i18n>primaryContact}" tooltip="{i18n>primaryContact}"/>
                                                    </Column>

                                                    <Column>
                                                        <customData>
                                                            <core:CustomData key="p13nData" value='\{"columnKey": "ssa", "columnIndex" : "3", "leadingProperty": "ssa", "sortProperty": "ssa", "filterProperty": "ssa", "type":"string"}'/>
                                                        </customData>
                                                        <Label text="{i18n>ssa}"/>
                                                    </Column>

                                                    <Column hAlign="Center">
                                                        <customData>
                                                            <core:CustomData key="p13nData" value='\{"columnKey": "opportunityClosedQuarter", "columnIndex" : "4", "leadingProperty": "opportunityClosedQuarter", "sortProperty": "opportunityClosedQuarter", "filterProperty": "opportunityClosedQuarter", "type":"string"}'/>
                                                        </customData>
                                                        <Label text="{i18n>opportunityClosedQuarter}"/>
                                                    </Column>

                                                    <Column hAlign="Center">
                                                        <customData>
                                                            <core:CustomData key="p13nData" value='\{"columnKey": "topic", "columnIndex" : "5", "leadingProperty": "topic", "sortProperty": "topic", "filterProperty": "topic", "type":"string"}'/>
                                                        </customData>
                                                        <Label text="{i18n>topic}"/>
                                                    </Column>

                                                     <Column hAlign="Center">
                                                        <customData>
                                                            <core:CustomData key="p13nData" value='\{"columnKey": "opportunityValue", "columnIndex" : "6", "leadingProperty": "opportunityValue", "sortProperty": "opportunityValue", "filterProperty": "opportunityValue", "type":"string"}'/>
                                                        </customData>
                                                        <Label text="{i18n>opportunityValue}"/>
                                                    </Column>

                                                    <Column hAlign="Center" >
                                                        <customData>
                                                            <core:CustomData key="p13nData" value='\{"columnKey": "status", "columnIndex" : "7", "leadingProperty": "status", "sortProperty": "status", "filterProperty": "status", "type":"string"}'/>
                                                        </customData>
                                                        <Label text="{i18n>status}"/>
                                                    </Column>

                                                
                                                     <Column width="3rem">
                                                        <customData>
                                                            <core:CustomData key="p13nData" value='\{"columnKey": "isFavorite", "columnIndex" : "8", "leadingProperty": "isFavorite", "sortProperty": "isFavorite", "filterProperty": "isFavorite", "type":"boolean"}'/>
                                                        </customData>
                                                        <Label/>
                                                    </Column>

                                                                                                   
                                                </columns>
                                                <items>
                                                   <ColumnListItem type="Navigation" vAlign="Middle"  press="onListItemPress" 
                                                     highlight="{path:'status', formatter:'.formatter.formatRowHighlight'}">

                                                    <cells>
                                                    <Text text="{account}" />
                                                    <Text text="{primaryContact}" />
                                                    <Text text="{ssa}" />
                                                    <Text text="{opportunityClosedQuarter}" />
                                                    <tnt:InfoLabel  text="{topic}" colorScheme="{path:'topic', formatter:'.formatter.topicColorSchemeFormatter'}" visible="{= ${topic} !== null}" renderMode="Narrow"/> 
                                                     <!-- <ComboBox items="{/topics}" >
                                                        <items>
                                                            <core:Item key="{topic}" text="{topic}" />
                                                        </items>
                                                        </ComboBox> -->
                                                    <ObjectNumber
                                                    number="{path: 'opportunityValue', type: 'sap.ui.model.type.Float', formatter: '.formatter.addKAfterNumber', formatOptions: {decimals: 0}}"
                                                    unit="EUR"
                                                    visible="{= ${opportunityValue} !== null}"/>
                                                    <ObjectStatus text="{status}" state="{path: 'status', formatter:'.formatter.formatStatusColor'}" visible="{= ${status} !== null}"
                                                    icon="{path: 'status', formatter:'.formatter.formatStatusIcon'}" iconDensityAware="true"/>

                                                    <core:Icon press="onFavoritePress"
                                                                src="sap-icon://unfavorite"
                                                                size="1.0rem"
                                                                color="#427cac"/>

                       
                                                    </cells>
                                                </ColumnListItem>


                                                                                        
                                                                                    </items>
                                                                                </Table>
                                        


       </smartTable:SmartTable>

         
        </f:content>
    </f:DynamicPage>
</mvc:View>
